import electron from 'electron';
import PlugModule from 'plug-module';
import PlugMenu from '../plug-menu';

const mod = new PlugModule('contextMenu');
const contextMenu = new PlugMenu('context');
let menuItems;

mod.createMethod('useContextMenu', contextMenu.use.bind(contextMenu));
mod.createMethod('getContextMenuItemById', contextMenu.getMenuItemById.bind(contextMenu));
mod.createMethod('updateContextMenuItemById', contextMenu.updateMenuItemById.bind(contextMenu));
mod.addMethod('onContextMenuClick', contextMenu.onMenuClick.bind(contextMenu));
mod.injectMethodsToGlobal();

mod.addMainBootstrapper(bootstrap);

function bootstrap(config) {
    contextMenu.bootstrap(config.contextMenu, menu => menuItems = menu);

    plug.on('plug.window.context-menu', (event, win, params) => {
        event.preventDefault();
        menuItems.popup(win);
    });
}

export default mod.exportModule();